var _t=Object.defineProperty;var te=(r,t,e)=>t in r?_t(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>te(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class Wt{constructor(t,e){o(this,"name");o(this,"symbol");o(this,"renderName",!0);o(this,"renderSymbol",!0);this.name=t,this.symbol=e}log(...t){const e=new Array,s=new Array;for(const i of t)typeof i=="string"?e.push(i):s.push(i);console.log(this.getFixed(...e),...s)}warn(...t){const e=new Array,s=new Array;for(const i of t)typeof i=="string"?e.push(i):s.push(i);console.warn(this.getFixed(...e),...s)}error(...t){const e=new Array,s=new Array;for(const i of t)typeof i=="string"?e.push(i):s.push(i);console.error(this.getFixed(...e),...s)}throw(...t){throw this.getFixed(...t)}toggleName(){this.renderName=!this.renderName}toggleSymbol(){this.renderSymbol=!this.renderSymbol}getFixed(...t){return this.renderSymbol&&this.symbol?this.renderName?`${this.symbol} [${this.name}] ${t} ${this.symbol}`:`${this.symbol} ${t} ${this.symbol}`:this.renderName?`[${this.name}] ${t}`:`${t}`}}class ee{constructor(){o(this,"lastTime",performance.now());o(this,"FPS",0)}update(){const t=performance.now(),e=t-this.lastTime;return this.lastTime=t,this.FPS=1e3/e,e}}function Ht(r,t,e=""){if(r==null)throw new Error(t+`
`+e)}function Xt(r,t,...e){const s=document.createElement(r);return t!==void 0&&(t.parent!==void 0&&(t.parent.appendChild(s),delete t.parent),t.classes!==void 0&&t.classes.length>0&&(s.classList.add(...t.classes),delete t.classes),Object.assign(s,t)),s.append(...e),s}function Q(r,...t){return Xt("div",r,...t)}function ht(r,...t){return Xt("canvas",r,...t)}function N(r){const t=document.getElementById(r);return Ht(t,`Element with id "${r}" not found.`),t}function se(r){return[...document.getElementsByClassName(r)]}function xt(r){return document.querySelector(r)}function ie(){setTimeout(()=>{const r=[...document.getElementsByClassName("preload")];for(const t of r)t.classList.remove("preload")},500)}var $=(r=>(r[r.LEFT=0]="LEFT",r[r.MIDDLE=1]="MIDDLE",r[r.RIGHT=2]="RIGHT",r))($||{});const at=class at{constructor(t){o(this,"x",0);o(this,"y",0);o(this,"element");this.element=t,Ht(t,"MouseAttachment can only be attached to HTMLElements."),this.element.addEventListener("mousemove",e=>{this.x=e.clientX,this.y=e.clientY})}static attach(t){return at.instances.has(t)?at.instances.get(t):new at(t)}set onDown(t){this.element.addEventListener("mousedown",e=>t(e.button))}set onUp(t){this.element.addEventListener("mouseup",e=>t(e.button))}set onClick(t){this.element.addEventListener("click",e=>t(e.button))}set onMove(t){this.element.addEventListener("mousemove",e=>t(e.movementX,e.movementY))}set onDrag(t){this.element.addEventListener("drag",e=>t(e.movementX,e.movementY))}set onDragStart(t){this.element.addEventListener("dragstart",()=>t())}set onDragStop(t){this.element.addEventListener("dragend",()=>t())}set onDragOver(t){this.element.addEventListener("dragover",()=>t())}set onEnter(t){this.element.addEventListener("mouseenter",()=>t())}set onHover(t){this.element.addEventListener("mouseover",()=>t())}set onLeave(t){this.element.addEventListener("mouseleave",()=>t())}set onWheel(t){this.element.addEventListener("wheel",e=>t(e.deltaY))}set onResize(t){this.element.addEventListener("resize",()=>t(this.element.clientWidth,this.element.clientHeight))}set onDownRaw(t){this.element.addEventListener("mousedown",t)}set onUpRaw(t){this.element.addEventListener("mouseup",t)}set onClickRaw(t){this.element.addEventListener("click",t)}set onMoveRaw(t){this.element.addEventListener("mousemove",t)}set onDragRaw(t){this.element.addEventListener("drag",t)}set onDragStartRaw(t){this.element.addEventListener("dragstart",t)}set onDragStopRaw(t){this.element.addEventListener("dragend",t)}set onDragOverRaw(t){this.element.addEventListener("dragover",t)}set onEnterRaw(t){this.element.addEventListener("mouseenter",t)}set onHoverRaw(t){this.element.addEventListener("mouseover",t)}set onLeaveRaw(t){this.element.addEventListener("mouseleave",t)}set onWheelRaw(t){this.element.addEventListener("wheel",t)}};o(at,"instances",new Map);let W=at;class j{constructor(t){o(this,"root");this.root=t}initialize(){}update(t){}updateFrame(){}}class Yt extends j{initialize(){const t=N("currency-screen-wrapper");W.attach(t).onClickRaw=e=>{e.button===$.LEFT&&(t.classList.toggle("enabled"),e.stopPropagation())}}static registerCurrency(t){this.currencies.set(t.name,t),this.setupCurrencyElement(t)}static getCurrency(t){const e=this.currencies.get(t);return Ht(e,`Currency with id "${t}" not found!`),e}static setupCurrencyElement(t){const e=N("currency-screen");this.currencies.size>1&&Q({classes:["divider"],parent:e});const s=Q({id:`${t.name}-research`,classes:["currency"],parent:e},Xt("img",{classes:["currency-icon"],src:`src/assets/images/currencies/${t.name}.png`})),i=Q({classes:["currency-amount"],parent:s});t.attachElement(i)}}o(Yt,"currencies",new Map);class jt extends j{constructor(e,s){super(e);o(this,"body");o(this,"selector");this.body=document.getElementById(`${s}-screen`),this.selector=document.getElementById(`${s}-screen-option`),W.attach(this.selector).onClickRaw=i=>this.enable(e,i)}enable(e,s){e.disableAllScreens(),this.selector.classList.add("selected"),this.body.classList.add("active"),s&&s.stopPropagation()}disable(){this.selector.classList.remove("selected"),this.body.classList.remove("active")}}class lt{constructor(t,e,s,i){o(this,"x",0);o(this,"y",0);o(this,"width",0);o(this,"height",0);this.x=t,this.y=e,this.width=s,this.height=i}contains(t,e){return t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}containsRect(t){return this.contains(t.x,t.y)&&this.contains(t.x+t.width,t.y+t.height)}intersects(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}expandBy(t,e){return new lt(this.x-t,this.y-e,this.width+2*t,this.height+2*e)}scaleBy(t){return new lt(this.x*t,this.y*t,this.width*t,this.height*t)}floor(){return new lt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.width),Math.floor(this.height))}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get left(){return this.x}}class Tt{constructor(){o(this,"listeners",[])}add(t){this.listeners.push(t)}dispatch(...t){for(const e of this.listeners)e(...t)}}class M{constructor(t,e){o(this,"x");o(this,"y");this.x=this.cast(t),this.y=this.cast(e)}add(t){return typeof t=="number"&&(t=new M(t,t)),new M(this.x+t.x,this.y+t.y)}sub(t){return typeof t=="number"&&(t=new M(t,t)),new M(this.x-t.x,this.y-t.y)}mult(t){return typeof t=="number"&&(t=new M(t,t)),new M(this.x*t.x,this.y*t.y)}div(t){return typeof t=="number"&&(t=new M(t,t)),new M(this.x/t.x,this.y/t.y)}pow(t){return typeof t=="number"&&(t=new M(t,t)),new M(Math.pow(this.x,t.x),Math.pow(this.y,t.y))}min(t){return typeof t=="number"&&(t=new M(t,t)),new M(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return typeof t=="number"&&(t=new M(t,t)),new M(Math.max(this.x,t.x),Math.max(this.y,t.y))}abs(){return new M(Math.abs(this.x),Math.abs(this.y))}floor(){return new M(Math.floor(this.x),Math.floor(this.y))}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(t){return this.x*t.x+this.y*t.y}cast(t){return t}toString(){return`(${this.x}, ${this.y})`}}class Ot extends j{constructor(e,s){super(e);o(this,"background");o(this,"attachment");o(this,"context");o(this,"onCenterChange",new Tt);o(this,"onUpdate",new Tt);o(this,"worldX",0);o(this,"worldY",0);o(this,"renderRect",new lt(0,0,0,0));o(this,"top",0);o(this,"right",0);o(this,"bottom",0);o(this,"left",0);o(this,"grabbing",!1);this.background=N(s),this.attachment=W.attach(this.background),this.context=this.background.getContext("2d")}initialize(){this.background.width=this.root.windowWidth,this.background.height=this.root.windowHeight,this.root.windowMouse.onResize=(e,s)=>{this.background.width=e,this.background.height=s,this.reinitializeSides();const i=this.getCenter();this.onCenterChange.dispatch(i.x,i.y),this.onUpdate.dispatch()},this.reinitializeSides(),this.attachment.onDown=e=>{e===$.LEFT&&(this.grabbing=!0)},this.root.windowMouse.onUp=e=>{e===$.LEFT&&(this.grabbing=!1)},this.root.windowMouse.onLeave=()=>this.grabbing=!1,this.root.windowMouse.onMove=(e,s)=>{if(!this.grabbing)return;this.worldX+=e,this.worldY+=s,this.reinitializeSides();const i=this.getCenter();this.onCenterChange.dispatch(i.x,i.y),this.onUpdate.dispatch()}}screenToWorld(e,s){const i=this.getCenter();return new M(e-i.x,s-i.y)}worldToScreen(e,s){const i=this.getCenter();return new M(e+i.x,s+i.y)}reinitializeSides(){const e=this.root.windowWidth,s=this.root.windowHeight,i=this.worldX,n=this.worldY;this.right=e/2-i,this.bottom=s/2-n,this.left=-e/2-i,this.top=-s/2-n,this.renderRect.x=this.left,this.renderRect.y=this.top,this.renderRect.width=this.right-this.left,this.renderRect.height=this.bottom-this.top}startDrawing(){this.context.clearRect(0,0,this.root.windowWidth,this.root.windowHeight);const e=this.getCenter();this.context.save(),this.context.translate(e.x,e.y)}finalizeDrawing(){this.context.restore()}getCenter(){return new M(this.worldX+this.root.windowWidth/2,this.worldY+this.root.windowHeight/2)}}const Gt=(r=ge())=>ne(le(r)),ne=r=>({random:()=>Mt(r),uint32:()=>oe(r),fract53:()=>re(r),nextT:t=>{const e=ae(t);return()=>e(r)},getState:()=>({...r})}),Mt=r=>{const t=2091639*r.s0+r.c*23283064365386963e-26;return r.s0=r.s1,r.s1=r.s2,r.s2=t-(r.c=t|0)},oe=r=>Mt(r)*4294967296,re=r=>Mt(r)+(Mt(r)*2097152|0)*11102230246251565e-32,ae=r=>t=>r(Mt(t)),le=r=>he(r,ce()),he=(r,t)=>{let e=de,s=rt(e=ot(" ",e)),i=rt(e=ot(" ",e)),n=rt(e=ot(" ",e));const a=1;return s-=rt(e=ot(r,e)),s<0&&(s+=1),i-=rt(e=ot(r,e)),i<0&&(i+=1),n-=rt(e=ot(r,e)),n<0&&(n+=1),t.s0=s,t.s1=i,t.s2=n,t.c=a,t},ce=()=>({s0:0,s1:0,s2:0,c:0}),de=4022871197,ot=(r,t)=>{for(let e=0;e<r.length;e++){t+=r.charCodeAt(e);let s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=s*4294967296}return t},rt=r=>(r>>>0)*23283064365386963e-26,ge=()=>`${Date.now()}`,ue=r=>{const t=we(r);return{noise2D:(e,s)=>me(t,e,s),noise3D:(e,s,i)=>fe(t,e,s,i),noise4D:(e,s,i,n)=>pe(t,e,s,i,n)}},me=(r,t,e)=>{const{perm:s,permMod12:i}=r;let n=0,a=0,c=0;const l=(t+e)*ye,h=Math.floor(t+l),d=Math.floor(e+l),u=(h+d)*bt,g=h-u,m=d-u,f=t-g,k=e-m,p=f>k?1:0,A=f>k?0:1,w=f-p+bt,P=k-A+bt,L=f-1+2*bt,x=k-1+2*bt,v=h&255,T=d&255;let y=.5-f*f-k*k;if(y>=0){const I=i[v+s[T]]*3;y*=y,n=y*y*(B[I]*f+B[I+1]*k)}let E=.5-w*w-P*P;if(E>=0){const I=i[v+p+s[T+A]]*3;E*=E,a=E*E*(B[I]*w+B[I+1]*P)}let S=.5-L*L-x*x;if(S>=0){const I=i[v+1+s[T+1]]*3;S*=S,c=S*S*(B[I]*L+B[I+1]*x)}return 70*(n+a+c)},fe=(r,t,e,s)=>{const{perm:i,permMod12:n}=r;let a=0,c=0,l=0,h=0;const d=(t+e+s)*be,u=Math.floor(t+d),g=Math.floor(e+d),m=Math.floor(s+d),f=(u+g+m)*X,k=u-f,p=g-f,A=m-f,w=t-k,P=e-p,L=s-A;let x,v,T,y,E,S;w>=P?P>=L?(x=1,v=0,T=0,y=1,E=1,S=0):w>=L?(x=1,v=0,T=0,y=1,E=0,S=1):(x=0,v=0,T=1,y=1,E=0,S=1):P<L?(x=0,v=0,T=1,y=0,E=1,S=1):w<L?(x=0,v=1,T=0,y=0,E=1,S=1):(x=0,v=1,T=0,y=1,E=1,S=0);const I=w-x+X,H=P-v+X,V=L-T+X,_=w-y+2*X,tt=P-E+2*X,et=L-S+2*X,st=w-1+3*X,it=P-1+3*X,nt=L-1+3*X,J=u&255,K=g&255,Z=m&255;let q=.6-w*w-P*P-L*L;if(q>=0){const z=n[J+i[K+i[Z]]]*3;q*=q,a=q*q*(B[z]*w+B[z+1]*P+B[z+2]*L)}let U=.6-I*I-H*H-V*V;if(U>=0){const z=n[J+x+i[K+v+i[Z+T]]]*3;U*=U,c=U*U*(B[z]*I+B[z+1]*H+B[z+2]*V)}let O=.6-_*_-tt*tt-et*et;if(O>=0){const z=n[J+y+i[K+E+i[Z+S]]]*3;O*=O,l=O*O*(B[z]*_+B[z+1]*tt+B[z+2]*et)}let G=.6-st*st-it*it-nt*nt;if(G>=0){const z=n[J+1+i[K+1+i[Z+1]]]*3;G*=G,h=G*G*(B[z]*st+B[z+1]*it+B[z+2]*nt)}return 32*(a+c+l+h)},pe=(r,t,e,s,i)=>{const{perm:n}=r;let a=0,c=0,l=0,h=0,d=0;const u=(t+e+s+i)*xe,g=Math.floor(t+u),m=Math.floor(e+u),f=Math.floor(s+u),k=Math.floor(i+u),p=(g+m+f+k)*R,A=g-p,w=m-p,P=f-p,L=k-p,x=t-A,v=e-w,T=s-P,y=i-L;let E=0,S=0,I=0,H=0;x>v?E++:S++,x>T?E++:I++,x>y?E++:H++,v>T?S++:I++,v>y?S++:H++,T>y?I++:H++;let V,_,tt,et,st,it,nt,J,K,Z,q,U;V=E>=3?1:0,_=S>=3?1:0,tt=I>=3?1:0,et=H>=3?1:0,st=E>=2?1:0,it=S>=2?1:0,nt=I>=2?1:0,J=H>=2?1:0,K=E>=1?1:0,Z=S>=1?1:0,q=I>=1?1:0,U=H>=1?1:0;const O=x-V+R,G=v-_+R,z=T-tt+R,St=y-et+R,Ct=x-st+2*R,kt=v-it+2*R,Lt=T-nt+2*R,It=y-J+2*R,zt=x-K+3*R,Ft=v-Z+3*R,Bt=T-q+3*R,Pt=y-U+3*R,Rt=x-1+4*R,Nt=v-1+4*R,$t=T-1+4*R,At=y-1+4*R,ct=g&255,dt=m&255,gt=f&255,ut=k&255;let mt=.6-x*x-v*v-T*T-y*y;if(mt>=0){const b=n[ct+n[dt+n[gt+n[ut]]]]%32*4;mt*=mt,a=mt*mt*(C[b]*x+C[b+1]*v+C[b+2]*T+C[b+3]*y)}let ft=.6-O*O-G*G-z*z-St*St;if(ft>=0){const b=n[ct+V+n[dt+_+n[gt+tt+n[ut+et]]]]%32*4;ft*=ft,c=ft*ft*(C[b]*O+C[b+1]*G+C[b+2]*z+C[b+3]*St)}let pt=.6-Ct*Ct-kt*kt-Lt*Lt-It*It;if(pt>=0){const b=n[ct+st+n[dt+it+n[gt+nt+n[ut+J]]]]%32*4;pt*=pt,l=pt*pt*(C[b]*Ct+C[b+1]*kt+C[b+2]*Lt+C[b+3]*It)}let wt=.6-zt*zt-Ft*Ft-Bt*Bt-Pt*Pt;if(wt>=0){const b=n[ct+K+n[dt+Z+n[gt+q+n[ut+U]]]]%32*4;wt*=wt,h=wt*wt*(C[b]*zt+C[b+1]*Ft+C[b+2]*Bt+C[b+3]*Pt)}let yt=.6-Rt*Rt-Nt*Nt-$t*$t-At*At;if(yt>=0){const b=n[ct+1+n[dt+1+n[gt+1+n[ut+1]]]]%32*4;yt*=yt,d=yt*yt*(C[b]*Rt+C[b+1]*Nt+C[b+2]*$t+C[b+3]*At)}return 27*(a+c+l+h+d)},we=r=>{const t=new Uint8Array(512),e=new Uint8Array(512),s=new Uint8Array(256);for(let n=0;n<256;n++)s[n]=n;for(let n=0;n<255;n++){const a=n+~~(r()*(256-n)),c=s[a];s[a]=s[n],t[n]=t[n+256]=c,e[n]=e[n+256]=c%12}const i=s[255];return t[255]=t[511]=i,e[255]=e[511]=i%12,{perm:t,permMod12:e}},ye=.5*(Math.sqrt(3)-1),bt=(3-Math.sqrt(3))/6,be=1/3,X=1/6,xe=(Math.sqrt(5)-1)/4,R=(5-Math.sqrt(5))/20,B=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),C=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class Qt{static loadImage(t){return new Promise((e,s)=>{const i=new Image;i.src=t,i.onload=()=>e(i),i.onerror=()=>s(new Error(`Failed to load image: ${t}`))})}static loadImages(t){return Promise.all(t.map(e=>this.loadImage(e)))}static loadImageWithName(t,e){return new Promise((s,i)=>{const n=new Image;n.src=t,n.onload=()=>s({name:e,image:n}),n.onerror=()=>i(new Error(`Failed to load image: ${t}`))})}static loadImagesWithNames(t){return Promise.all(t.map(({path:e,name:s})=>this.loadImageWithName(e,s)))}}class ve{constructor(){o(this,"flowers",new Array(32).fill(0).map((t,e)=>"grassandflowers"+(e+1)));o(this,"flowerCanvases",[]);o(this,"loaded",!1);o(this,"loadedEvent",new Tt);this.loadImages().then(e=>{for(const s of e)this.flowerCanvases.push(this.setupFlower(s));this.loaded=!0,this.loadedEvent.dispatch()})}getFlower(t){const e=Math.floor(t()*this.flowers.length);return this.flowerCanvases[e]}setupFlower(t){const e=ht();return e.width=16,e.height=16,e.getContext("2d").drawImage(t,0,0),e}loadImages(){return Qt.loadImages(this.flowers.map(t=>`src/assets/images/flowers/${t}.png`))}}class Te{constructor(){o(this,"sides",[]);o(this,"imagesByName",new Map);o(this,"texturesByHash",[]);o(this,"loaded",!1);o(this,"loadedEvent",new Tt)}loadImages(){return Qt.loadImagesWithNames(this.sides.map(t=>({path:`src/assets/images/tiles/${t}.png`,name:t})))}hashToNeighbors(t){const e=Array(8).fill(!1);for(let s=0;s<8;s++)e[s]=(t&1<<s)!==0;return e}neighborsToHash(t){return t.reduce((e,s,i)=>e+(s?1<<i:0),0)}}class Me extends Te{constructor(){super();o(this,"sides",["grass-corner","grass-side","grass-outer-corner"]);this.loadImages().then(s=>{for(const{name:i,image:n}of s)this.imagesByName.set(i,n);this.createTexturesByRules()})}getTextureByRules(e){const s=this.neighborsToHash(e),i=this.texturesByHash[s];if(!i)throw new Error(`No texture for neighbors: ${e.join(", ")}`);return i}createTexturesByRules(){for(let e=0;e<2**8;e++){const s=this.hashToNeighbors(e),i=ht();i.width=32,i.height=32;const n=i.getContext("2d"),a=this.imagesByName.get("grass-corner"),c=this.imagesByName.get("grass-outer-corner"),l=this.imagesByName.get("grass-side"),h=[[3,0,1],[1,2,4],[6,5,3],[4,7,6]],d=[0,Math.PI/2,-Math.PI/2,Math.PI];for(let u=0;u<2;u++)for(let g=0;g<2;g++){const m=u+2*g,f=h[m],k=d[m],p=s[f[0]],A=s[f[1]],w=s[f[2]];n.save(),n.translate(u*16+8,g*16+8),n.rotate(k),p&&A&&w?n.drawImage(a,-8,-8):!p&&w?(n.rotate(Math.PI/2),n.drawImage(l,-8,-8)):p&&!w?n.drawImage(l,-8,-8):!p&&!w&&A?n.drawImage(c,-8,-8):p&&w&&!A&&n.drawImage(a,-8,-8),n.restore()}this.texturesByHash[e]=i}this.loaded=!0,this.loadedEvent.dispatch()}}class Ee{constructor(t,e,s){o(this,"root");o(this,"background");o(this,"tileManager");o(this,"grassTileSet",new Me);o(this,"flowerSet",new ve);o(this,"random");o(this,"noise2D");this.root=t,this.background=e,this.tileManager=s;const{random:i}=Gt(this.root.seed),{noise2D:n}=ue(i);this.random=i,this.noise2D=n}drawEnvironment(){this.grassTileSet.loaded&&this.flowerSet.loaded&&this.drawBackground()}getNeighbors(t,e){return[this.tileManager.isInsideFarm(t-1,e-1),this.tileManager.isInsideFarm(t,e-1),this.tileManager.isInsideFarm(t+1,e-1),this.tileManager.isInsideFarm(t-1,e),this.tileManager.isInsideFarm(t+1,e),this.tileManager.isInsideFarm(t-1,e+1),this.tileManager.isInsideFarm(t,e+1),this.tileManager.isInsideFarm(t+1,e+1)]}}class Se extends Ee{drawBackground(){const t=this.background.context;t.imageSmoothingEnabled=!1,this.background.startDrawing();const e=this.background.renderRect,s=this.tileManager.farmRect,i=this.root.tileSize,n=Math.ceil(i/32),a=e.scaleBy(1/i).floor();for(let l=a.left;l<=a.right+1;l++)for(let h=a.top;h<=a.bottom+1;h++)t.translate(l*i,h*i),t.scale(n,n),s.contains(l,h)?(t.fillStyle="#e4a672",t.fillRect(0,0,32,32)):this.drawGrass(t,l,h,s),t.scale(1/n,1/n),t.translate(-l*i,-h*i);const c=s.expandBy(1,1);for(let l=a.left;l<=a.right+1;l++)for(let h=a.top;h<=a.bottom+1;h++){if(c.contains(l,h))continue;t.translate(l*i,h*i),t.scale(n,n);const d=this.tileManager.getFarmTile(l,h),u=this.getNeighbors(l,h);if(!d&&u.every(g=>!g))for(let g=0;g<2;g++)for(let m=0;m<2;m++){const f=l*2+g,k=h*2+m,{random:p}=Gt(`${this.root.seed} (${f}, ${k})`);if(p()>.2)continue;const A=this.flowerSet.getFlower(p),w=p()*16-8,P=p()*16-8,L=(p()-.5)*.4;A&&(t.translate(g*16+8,m*16+8),t.rotate(L),t.drawImage(A,w-8,P-8),t.rotate(-L),t.translate(-g*16-8,-m*16-8))}t.scale(1/n,1/n),t.translate(-l*i,-h*i)}this.background.finalizeDrawing()}drawGrass(t,e,s,i){for(let l=0;l<2;l++)for(let h=0;h<2;h++){const d=e*2+l,u=s*2+h,g=25,m=this.noise2D(d/g,u/g)*15;t.fillStyle=`rgb(${62+m} ${137+m} ${72+m})`,t.fillRect(l*16+1,h*16+1,17,17)}if(!i.expandBy(1,1).contains(e,s))return;const a=this.getNeighbors(e,s),c=this.grassTileSet.getTextureByRules(a);t.drawImage(c,0,0)}}class Jt extends j{constructor(e,s){super(e);o(this,"wrapper");o(this,"body");o(this,"holdingX",0);o(this,"holdingY",0);o(this,"prevX",-1);o(this,"prevY",-1);o(this,"angle",0);o(this,"angleVel",0);this.wrapper=Q({classes:["draggable-wrapper"]},s),this.body=s,N("drag-area").appendChild(this.wrapper)}update(e){e/=1e3;const s=this.root.windowMouse.x,i=this.root.windowMouse.y,n=50;this.prevX<0&&(this.prevX=s),this.prevY<0&&(this.prevY=i);const a=(this.prevX-s)*10,c=(this.prevY-i)*10+n,l=(.5-this.holdingX)**2+(.5-this.holdingY)**2,h=Math.atan2(.5-this.holdingY,.5-this.holdingX),d=c*Math.cos(this.angle+h)*Math.sqrt(l),g=a*-Math.sin(this.angle+h)*Math.sqrt(l)+d;this.angleVel+=g*e,this.angle+=this.angleVel*e,this.angleVel*=.995,this.prevX=s,this.prevY=i,this.wrapper.style.setProperty("--holding-x",`${this.holdingX}`),this.wrapper.style.setProperty("--holding-y",`${this.holdingY}`),this.wrapper.style.setProperty("--rotation",`${this.angle}rad`),this.wrapper.style.left=s+"px",this.wrapper.style.top=i+"px"}setHolding(e,s){this.holdingX=e,this.holdingY=s}destroy(){this.wrapper.remove()}}const Ce={stages:[{name:"Over-world",color:"#742",crops:[{name:"Carrot",desc:"A classic orange root vegetable that can be munched straight from the soil. Packed with vitamin A and a hint of crunch!",growthTime:15,unlocked:!0},{name:"Corn",desc:"Tall and golden, corn stalks are a staple on any farm. Perfect for popcorn nights or corn on the cob.",growthTime:30},{name:"Tomato",desc:"Juicy and red, tomatoes are perfect for salads, sauces, or just munching straight from the vine!",growthTime:18},{name:"Potato",desc:"A humble underground treasure that’s as versatile as it gets. Boil, mash, fry—potatoes do it all!",growthTime:22},{name:"Strawberry",desc:"Sweet and slightly tart, strawberries are a treat for both the farmer and anyone craving a fruity snack.",growthTime:12},{name:"Lettuce",desc:"Crispy and green, lettuce is great for salads or adding a bit of crunch to your sandwich.",growthTime:10},{name:"Pumpkin",desc:"A big orange vegetable that’s great for Halloween decorations and pies alike. Beware of spooky carvings!",growthTime:40},{name:"Wheat",desc:"A staple crop that forms the base for bread and tons of baked goodies. Watch the golden waves grow!",growthTime:25},{name:"Cabbage",desc:"A round, leafy vegetable that’s perfect for hearty soups, stews, and even a little sauerkraut.",growthTime:28},{name:"Blueberry",desc:"Small but mighty! These tiny blue gems are packed with flavor and antioxidants.",growthTime:14},{name:"Radish",desc:"A spicy little root with a kick. Great for salads or just nibbling on fresh from the ground.",growthTime:8},{name:"Sunflower",desc:"Not just a flower! These bright blooms also produce seeds, perfect for snacking or replanting.",growthTime:35}]}]},ke={cropData:Ce};class qt extends j{constructor(){super(...arguments);o(this,"body")}getByQuery(e){const s=this.body.querySelector(e);if(s===null)throw new Error(`No children with query ${e} found`);return s}getFirstChildClass(e){const s=this.body.querySelector(`.${e}`);if(s===null)throw new Error(`No children with class ${e} found`);return s}getChildID(e){const s=this.body.querySelector(`#${e}`);if(s===null)throw new Error(`No children with id ${e} found`);return s}}class Le extends qt{constructor(e,s,i,n){super(e);o(this,"name");o(this,"desc");o(this,"amount",0);o(this,"growTime",1);o(this,"replantAble",!0);o(this,"unlocked",!1);o(this,"seenBefore",!1);this.name=s,this.desc=i,this.growTime=n}setUnlocked(e){this.unlocked=e,this.body.classList.toggle("unlocked",this.unlocked),this.unlocked&&this.setSeenBefore(!0)}getUnlocked(){return this.unlocked}setSeenBefore(e){this.seenBefore=e,this.body.classList.toggle("seen-before",this.seenBefore)}getImage(){return`src/assets/images/crops/${this.name}.png`}createHTML(){const e=Q({classes:["crop"]});return this.name!==""&&(e.innerHTML=`<img class="icon" src="${this.getImage()}" alt="${this.name}">`),e}createElement(e){this.body=this.createHTML(),e.appendChild(this.body)}}class Ie extends j{constructor(e){super(e);o(this,"body");o(this,"innerBody");o(this,"informOuter");o(this,"inventory",[]);o(this,"renderingCrop",null);o(this,"draggingCrop",null);o(this,"dragging",null);o(this,"draggingTimeout",null);o(this,"expanded",!1);o(this,"informExpanded",!1);o(this,"toggleable",!0);this.body=N("inventory"),this.innerBody=N("inv-container"),this.informOuter=N("inform-outer")}initialize(){{const e=ke.cropData.stages;for(const s of e){const i=s.color,n=s.name,a=this.registerStage(n,i);for(const c of s.crops)this.registerCrop(a,c)}}{this.root.windowMouse.onUp=s=>{s===$.LEFT&&(this.dragging&&this.dragging.destroy(),this.dragging=null,this.draggingCrop=null)};const e=W.attach(this.body);e.onLeave=()=>{!this.draggingCrop&&!this.draggingTimeout||(this.toggleable||setTimeout(()=>this.completelyClose(),500),this.completelyClose())}}N("drawer-handle").addEventListener("click",()=>this.toggleSelection())}update(e){this.dragging&&this.dragging.update(e)}updateFrame(){this.renderingCrop&&(N("information-crop-amount").innerText=`[${this.renderingCrop.amount}]`)}registerStage(e,s){const i=Q({id:`stage-${e}`,classes:["stage-crops"],parent:this.innerBody});return i.style.setProperty("--stage-color",s),{name:e,color:s,crops:[],body:i}}registerCrop(e,s){const i=new Le(this.root,s.name,s.desc,s.growthTime);e.crops.push(i),i.createElement(e.body),s.unlocked&&i.setUnlocked(!0);const n=W.attach(i.body);n.onClick=a=>{a===$.LEFT&&i.getUnlocked()&&this.toggleCropRender(i)},n.onDown=a=>{if(a!==$.LEFT||!i.getUnlocked())return;const l=i.body.getBoundingClientRect(),h=new M(l.left,l.top),d=l.width,u=this.root.windowMouse.x,g=this.root.windowMouse.y,f=new M(u,g).sub(h).div(d);this.draggingTimeout=setTimeout(()=>{this.startDraggingCrop(i,f),this.draggingTimeout=null},200)},n.onUp=a=>{a===$.LEFT&&this.draggingTimeout&&(clearTimeout(this.draggingTimeout),this.draggingTimeout=null)}}toggleSelection(){this.toggleable&&(this.toggleable=!1,setTimeout(()=>this.toggleable=!0,500),this.informExpanded?(this.informExpanded=!1,this.renderingCrop=null,this.getAudio("closing").play()):this.expanded?(this.expanded=!1,this.getAudio("closing").play()):(this.expanded=!0,this.getAudio("opening").play()),this.body.classList.toggle("open",this.expanded),this.informOuter.classList.toggle("open",this.informExpanded))}completelyClose(){if(!this.toggleable){setTimeout(()=>this.completelyClose(),500);return}!this.informExpanded&&!this.expanded||(this.expanded=!1,this.informExpanded=!1,this.body.classList.toggle("open",!1),this.informOuter.classList.toggle("open",!1),this.getAudio("closing").play())}toggleCropRender(e){if(!this.toggleable){setTimeout(this.toggleCropRender.bind(this),100);return}(this.renderingCrop===null||this.renderingCrop===e)&&(this.toggleable=!1,setTimeout(()=>this.toggleable=!0,500)),this.renderingCrop===e?this.renderingCrop=null:this.renderingCrop=e;const s=e.name.split("_").map(n=>n[0].toUpperCase()+n.slice(1)).join(" "),i=N("inform-drawer");this.informExpanded!==!!this.renderingCrop&&(this.informExpanded=!!this.renderingCrop,this.informOuter.classList.toggle("open",this.informExpanded),this.getAudio(this.informExpanded?"opening":"closing").play()),this.informOuter.classList.toggle("open",this.informExpanded),this.renderingCrop&&(i.innerHTML=`
            <div class="header">
                <span class="name">${s}</span><span id="information-crop-amount" class="amount">[${e.amount}]</span>
                <span class="desc">${e.desc}</span>
            </div>
            <div class="divider"></div>
            <div class="body">
                <div class="buttons">
                    <button class="sell">Sell 1</button>
                    <button class="sell">Sell 10</button>
                    <button class="sell-all">Sell All</button>
                </div>
            </div>
        `)}startDraggingCrop(e,s){if(this.dragging)return;this.draggingCrop=e;const i=e.createHTML();this.dragging=new Jt(this.root,i),this.dragging.setHolding(s.x,s.y)}getAudio(e){return N(`drawer-${e}`)}}class ze extends qt{constructor(e,s,i){super(e);o(this,"tileImage");o(this,"currentCrop",null);o(this,"cropBody",null);o(this,"growthState",0);o(this,"progress",0);o(this,"growthWobble",null);o(this,"x");o(this,"y");this.x=s,this.y=i}update(e){if(this.currentCrop&&this.progress<100){if(this.progress+=100/this.currentCrop.growTime*e,this.progress<100)return;this.currentCrop.replantAble?this.replantCrop():(this.cropBody.classList.add("done"),setTimeout(this.cleanCrop.bind(this),500))}}updateFrame(){if(!this.cropBody)return;const e=Math.floor(this.progress/25);this.growthState!==e&&(this.growthState=e,this.cropBody.classList.add("wobble"),this.growthWobble&&clearTimeout(this.growthWobble),this.growthWobble=setTimeout(()=>this.cropBody.classList.remove("wobble"),500),this.cropBody.style.setProperty("--progress",`${this.growthState/5+.2}`))}updatePosition(e,s,i){this.x=e,this.y=s;const n=this.x-i.left,a=this.y-i.top;this.body.style.left=n*63+"px",this.body.style.top=a*63+"px"}harvestCrop(){this.currentCrop&&this.cropBody&&(this.progress<100||this.currentCrop.amount++)}cleanCrop(){this.currentCrop&&this.cropBody&&(this.harvestCrop(),this.cropBody.remove(),this.growthWobble&&clearTimeout(this.growthWobble),this.currentCrop=null,this.cropBody=null)}plantCrop(e){this.currentCrop=e,this.cropBody=e.createHTML(),this.cropBody.style.setProperty("--progress","0.20"),this.body.appendChild(this.cropBody),this.progress=0}replantCrop(){this.currentCrop&&this.cropBody&&(this.harvestCrop(),this.cropBody.style.setProperty("--progress","0.2"),this.progress=0)}isEmpty(){return!this.currentCrop}createElement(e){this.body=Q({classes:["land-wrapper"],parent:e}),this.tileImage=ht({classes:["land-tile"],parent:this.body}),this.tileImage.width=32,this.tileImage.height=32,this.updateFrame()}drawTileImage(e){this.tileImage.getContext("2d").drawImage(e,0,0)}cloneBody(){const e=this.body.cloneNode(!0);return e.style.left="",e.style.top="",e.querySelector("canvas").getContext("2d").drawImage(this.tileImage,0,0),e}}const Y=class Y{static generateTheFarmTile(t){this.tileImage.width=32,this.tileImage.height=32;const e=this.tileImage.getContext("2d");e.translate(16,16);for(let s=0;s<4;s++)e.drawImage(t[0].image,-16,-16),e.rotate(Math.PI/2);e.translate(-16,-16),e.drawImage(t[1].image,0,0)}static loadImages(){return Promise.all(this.sides.map(t=>new Promise((e,s)=>{const i=new Image,n=`src/assets/images/tiles/${t}.png`;i.src=n,i.onload=()=>e({name:t,image:i}),i.onerror=()=>s(new Error(`Failed to load image: ${n}`))})))}};o(Y,"sides",["farm-corner","wetness"]),o(Y,"tileImage",ht()),o(Y,"loaded",!1),o(Y,"loadedImage",new Tt),Y.loadImages().then(e=>{Y.generateTheFarmTile(e),Y.loaded=!0,Y.loadedImage.dispatch()});let vt=Y;class Fe extends j{constructor(e,s){super(e);o(this,"background");o(this,"mouseCanvas");o(this,"farmTiles",new Map);o(this,"farmTilesBody");o(this,"farmRect");o(this,"grabbingTile",null);o(this,"dragging",null);this.background=s,this.farmTilesBody=N("farm-tiles"),this.farmRect=new lt(-2,-2,4,4)}initialize(){if(!vt.loaded){vt.loadedImage.add(()=>this.initialize());return}const e=this.root.tileSize;{this.farmTilesBody.style.width=e*this.farmRect.width+"px",this.farmTilesBody.style.height=e*this.farmRect.height+"px",this.background.onUpdate.add(()=>{const i=this.background.getCenter();this.farmTilesBody.style.left=i.x+"px",this.farmTilesBody.style.top=i.y+"px"});const s=this.background.getCenter();this.farmTilesBody.style.left=s.x+"px",this.farmTilesBody.style.top=s.y+"px"}this.root.windowMouse.onMove=()=>{const s=this.root.windowMouse,n=this.background.screenToWorld(s.x,s.y).div(e).floor().mult(e),a=this.background.worldToScreen(n.x,n.y);this.mouseCanvas.style.left=a.x+"px",this.mouseCanvas.style.top=a.y+"px"},this.root.windowMouse.onLeave=()=>{this.mouseCanvas.style.left="-100px",this.mouseCanvas.style.top="-100px"};{this.mouseCanvas=ht({id:"mouse-canvas"}),this.mouseCanvas.width=e,this.mouseCanvas.height=e,this.mouseCanvas.style.visibility="hidden",N("farming-screen").appendChild(this.mouseCanvas);const i=this.mouseCanvas.getContext("2d"),n=4,a=10,c=this.mouseCanvas.width;i.strokeStyle="#4f3",i.lineWidth=2;const l=n,h=c-n,d=n,u=c-n;i.beginPath(),i.moveTo(l+a,d),i.lineTo(h-a,d),i.arc(h-a,d+a,a,-Math.PI/2,0),i.lineTo(h,u-a),i.arc(h-a,u-a,a,0,Math.PI/2),i.lineTo(l+a,u),i.arc(l+a,u-a,a,Math.PI/2,Math.PI),i.lineTo(l,d+a),i.arc(l+a,d+a,a,Math.PI,Math.PI*3/2),i.closePath(),i.stroke()}{const s=this.background.attachment;let i=null,n=null;s.onDown=a=>{if(a!==$.LEFT)return;const c=this.root.windowMouse.x,l=this.root.windowMouse.y,h=this.screenToTile(c,l);this.grabbingTile=this.getFarmTile(h.x,h.y),this.grabbingTile&&(i=h,this.grabbingTile.body.classList.add("grabbing"),this.background.grabbing=!1,n=setTimeout(()=>{this.grabbingTile.body.classList.add("grabbed"),this.background.grabbing=!1,this.mouseCanvas.style.visibility="visible",this.dragging=new Jt(this.root,this.grabbingTile.cloneBody());const u=this.background.screenToWorld(c,l).div(e).sub(h);this.dragging.setHolding(u.x,u.y),n=null},1e3))},s.onMove=()=>{if(!n||!i)return;const a=this.root.windowMouse.x,c=this.root.windowMouse.y,l=this.screenToTile(a,c);l.x===i.x&&l.y===i.y||(this.stopDragging(),clearTimeout(n),n=null)},s.onUp=a=>{if(a!==$.LEFT||(n&&(clearTimeout(n),n=null),!this.grabbingTile))return;const c=this.grabbingTile.body.classList;c.add("drop-pop"),setTimeout(()=>c.remove("drop-pop"),200);const l=this.root.windowMouse.x,h=this.root.windowMouse.y,d=this.screenToTile(l,h),u=this.farmRect.contains(d.x,d.y),g=this.getFarmTile(d.x,d.y);if(u&&!g){const m=this.getId(this.grabbingTile.x,this.grabbingTile.y),f=this.getId(d.x,d.y);this.farmTiles.delete(m),this.farmTiles.set(f,this.grabbingTile),this.grabbingTile.updatePosition(d.x,d.y,this.farmRect)}this.stopDragging()}}this.addFarmTile()}update(e){this.dragging&&this.dragging.update(e)}getFarmTile(e,s){return this.farmTiles.get(this.getId(e,s))||null}isInsideFarm(e,s){return this.farmRect.contains(e,s)}addFarmTile(){const e=this.farmRect.width*this.farmRect.height;if(this.farmTiles.size>=e)throw new Error("Farm is full, can't add more tiles!");for(let s=this.farmRect.top;s<this.farmRect.bottom;s++)for(let i=this.farmRect.left;i<this.farmRect.right;i++){const n=this.getId(i,s);if(this.farmTiles.has(n))continue;const a=new ze(this.root,i,s),c=vt.tileImage;a.createElement(this.farmTilesBody),a.drawTileImage(c),a.updatePosition(i,s,this.farmRect),this.farmTiles.set(n,a);return}}stopDragging(){var e;this.grabbingTile&&(this.mouseCanvas.style.visibility="hidden",this.grabbingTile.body.classList.remove("grabbing"),this.grabbingTile.body.classList.remove("grabbed"),this.grabbingTile=null,(e=this.dragging)==null||e.destroy(),this.dragging=null)}getId(e,s){return`(${e}, ${s})`}screenToTile(e,s){return this.background.screenToWorld(e,s).div(this.root.tileSize).floor()}}class Be extends jt{constructor(e){super(e,"farming");o(this,"background");o(this,"tileManager");o(this,"inventory",new Ie(this.root));o(this,"environment");this.background=new Ot(e,"farming-background"),this.tileManager=new Fe(e,this.background),this.environment=new Se(e,this.background,this.tileManager)}initialize(){this.background.initialize(),this.inventory.initialize(),this.tileManager.initialize(),this.background.attachment.onClick=e=>{e===$.LEFT&&this.inventory.completelyClose()}}update(e){this.inventory.update(e),this.tileManager.update(e)}updateFrame(){this.environment.drawEnvironment(),this.inventory.updateFrame(),this.tileManager.updateFrame()}}class Pe extends j{constructor(){super(...arguments);o(this,"autoSave",!0);o(this,"exportToClipboard",!1)}initialize(){this.initializeSaveSettings()}initializeSaveSettings(){{const e=xt("#auto-save-toggle");W.attach(e).onClick=s=>{if(s!==$.LEFT)return;e.querySelector(".checkbox-thumb").classList.toggle("enabled"),this.autoSave=!this.autoSave}}{const e=xt("#import-save");W.attach(e).onClick=n=>{$.LEFT};const s=xt("#export-save");W.attach(s).onClick=n=>{$.LEFT};const i=xt("#export-clipboard");W.attach(i).onClick=n=>{$.LEFT}}}}class D{constructor(t=0,e=0){o(this,"mantissa");o(this,"exponent");o(this,"attachedElements",[]);this.setParts(t,e)}attachElement(t){this.attachedElements.push(t),t.innerText=this.toString()}updateElements(){for(const t of this.attachedElements)t.innerText=this.toString()}static fromNumber(t){if(isNaN(t)||!isFinite(t))throw new Error("Invalid number.");const[e,s]=t.toExponential().split("e").map(Number);return new D(e,s)}static fromString(t){const[e,s]=t.split("e").map(Number);return new D(e,s)}toString(){return this.exponent<6?`${Math.round(this.mantissa*Math.pow(10,this.exponent))}`:`${this.mantissa.toFixed(2)}e${this.exponent}`}setParts(t,e){if(isNaN(t)||isNaN(e)||!isFinite(t)||!isFinite(e))throw new Error("Invalid number parts.");this.mantissa=t,this.exponent=e,this.normalize(),this.updateElements()}normalize(){let t=this.mantissa,e=this.exponent;if(!Number.isInteger(e)){const s=Math.floor(e),i=e-s;t*=Math.pow(10,i),e=s}if(t===0)t=0;else{for(;Math.abs(t)>=10;)t/=10,e++;for(;Math.abs(t)<1&&t!==0;)t*=10,e--;t=parseFloat(t.toFixed(6))}this.mantissa=t,this.exponent=e}equals(t){return this.mantissa===t.mantissa&&this.exponent===t.exponent}greaterThan(t){return this.mantissa>t.mantissa||this.mantissa===t.mantissa&&this.exponent>t.exponent}greaterThanScalar(t){return this.greaterThan(D.fromNumber(t))}lessThan(t){return this.mantissa<t.mantissa||this.mantissa===t.mantissa&&this.exponent<t.exponent}lessThanScalar(t){return this.lessThan(D.fromNumber(t))}add(t){let e,s;this.exponent>t.exponent?(e=this,s=t):(e=t,s=this);const i=e.exponent-s.exponent,n=s.mantissa*Math.pow(10,-i),a=e.mantissa+n;this.setParts(a,e.exponent)}sub(t){this.add(new D(-t.mantissa,t.exponent))}mult(t){const e=this.mantissa*t.mantissa,s=this.exponent+t.exponent;this.setParts(e,s)}div(t){if(t.mantissa===0)throw new Error("Division by zero.");const e=this.mantissa/t.mantissa,s=this.exponent-t.exponent;this.setParts(e,s)}pow(t){const s=(Math.log10(this.mantissa)+this.exponent)*t.mantissa*Math.pow(10,t.exponent),i=Math.pow(10,s%1),n=Math.floor(s);this.setParts(i,n)}addScalar(t){this.add(new D(t,0))}subScalar(t){this.sub(new D(t,0))}multScalar(t){this.mult(new D(t,0))}divScalar(t){this.div(new D(t,0))}powScalar(t){const e=Math.pow(this.mantissa,t),s=this.exponent*t;this.setParts(e,s)}log10(){const t=Math.log10(this.mantissa)+this.exponent;return new D(t,0)}ln(){const t=Math.log(this.mantissa)+this.exponent*Math.LN10;return new D(t,0)}}class Re extends j{constructor(e,s,i,n){super(e);o(this,"name");o(this,"color");o(this,"amount");this.name=s,this.color=i,this.amount=D.fromNumber(n)}attachElement(e){this.amount.attachElement(e),e.style.setProperty("--currency-color",this.color)}}class Ne extends Re{constructor(t){super(t,"Plant-Food","#af4",0)}}class $e extends qt{constructor(e,s,i,n,a,c,l){super(e);o(this,"x");o(this,"y");o(this,"prevX");o(this,"prevY");o(this,"staticPoint");o(this,"name");o(this,"desc");o(this,"requires",[]);this.prevX=this.x=s,this.prevY=this.y=i,this.staticPoint=n,this.name=a,this.desc=c,this.requires=l}initialize(){const e=W.attach(this.body);e.onHover=()=>{console.log("hover")}}updateWorldTransform(e,s){this.body.style.left=`${e+this.x}px`,this.body.style.top=`${s+this.y}px`}attractTowards(e){let s=0,i=0;for(let n=0;n<e.length;n++){const a=e[n],c=a.x-this.x,l=a.y-this.y,d=1/(c*c+l*l);s+=c*d,i+=l*d}this.x+=s,this.y+=i}killAttractors(e){for(let i=0;i<e.length;i++){const n=e[i],a=n.x-this.x,c=n.y-this.y;a*a+c*c<50*50&&(e.splice(i,1),i--)}}update(){this.staticPoint||(this.prevX=this.x,this.prevY=this.y)}maintainChains(){for(const e of this.requires){const s=Et.nodesByName.get(e);this.chainNodes(s)}}chainNodes(e){if(this.staticPoint)return;const s=this.x-e.x,i=this.y-e.y,n=s*s+i*i,a=Math.sqrt(n);let c=-this.y;c<0&&(c=0);const l=100-c/100;if(a<l)return;const h=l*s/a,d=l*i/a;this.x=e.x+h,this.y=e.y+d}pushNode(e){const s=e.x-this.x,i=e.y-this.y,n=s*s+i*i,a=Math.sqrt(n);if(a<.01||a>100)return;let c=1/(a/200);c>500&&(c=500);const l=c*s/a,h=c*i/a;this.staticPoint||(this.x-=l,this.y-=h),e.staticPoint||(e.x+=l,e.y+=h)}createElement(e){this.body=Q({id:this.name,classes:["tech-node"],parent:e})}}const F=class F extends j{constructor(){super(...arguments);o(this,"nodeLeaves",[]);o(this,"nodeAttractors",[]);o(this,"activeNodes",new Set)}initialize(){const e=N("technology-screen"),s=Q({id:"technology-tree",parent:e});this.root.windowMouse.onClick=i=>{if(i!==$.LEFT)return;const n=F.nodesByName.size,a="test"+n,c=this.nodeLeaves[Math.floor(Math.random()*this.nodeLeaves.length)],l="test"+c,h=F.allNodes[c],d=(h==null?void 0:h.x)??0,u=(h==null?void 0:h.y)??0,g=new $e(this.root,d,u,n===0,a,a,[l]),m=Math.log2(-g.y/100),f=100;for(let p=0;p<1e3;p++){const A=(Math.random()-.5)*f,w=Math.random()*-100-50;this.nodeAttractors.push(new M(A,w))}let k=0;do this.nodeLeaves.push(n);while(k++<m);F.nodesByName.set(a,g),F.allNodes.push(g),g.createElement(s),g.initialize(),h&&(this.activeNodes.add(g),this.nodeLeaves.splice(this.nodeLeaves.findIndex(p=>p===c),1),this.nodeLeaves.includes(c)||(this.activeNodes.delete(h),h.staticPoint=!0))}}update(){for(const e of this.activeNodes)e.attractTowards(this.nodeAttractors);for(const e of this.activeNodes)e.killAttractors(this.nodeAttractors);for(let e=0;e<F.allNodes.length;e++){const s=F.allNodes[e];for(let i=e+1;i<F.allNodes.length;i++){const n=F.allNodes[i];s.pushNode(n)}}for(let e=1;e<F.allNodes.length;e++)F.allNodes[e].maintainChains()}drawLines(e){for(const s of F.allNodes)for(const i of s.requires){const n=F.nodesByName.get(i);n&&(e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(n.x,n.y),e.stroke())}for(const s of this.nodeAttractors)e.beginPath(),e.arc(s.x,s.y,5,0,2*Math.PI),e.fillStyle="#f00",e.fill()}updateWorldTransform(e,s){F.nodesByName.forEach(i=>i.updateWorldTransform(e,s))}};o(F,"allNodes",[]),o(F,"nodesByName",new Map),o(F,"curreny");let Et=F;class Ae extends jt{constructor(e){super(e,"technology");o(this,"background");o(this,"tileCanvas");o(this,"tileSize",100);o(this,"techTree");o(this,"currency");this.background=new Ot(e,"technology-background"),this.techTree=new Et(e),this.currency=new Ne(e),Yt.registerCurrency(this.currency)}initialize(){this.background.initialize(),this.background.onCenterChange.add(this.updateWorldTransform.bind(this)),this.techTree.initialize(),this.currency.initialize(),this.setupTileCanvas(),this.updateWorldTransform()}update(){this.techTree.update()}updateFrame(){this.drawBackground(),this.updateWorldTransform()}updateWorldTransform(){const e=this.background.getCenter();this.techTree.updateWorldTransform(e.x,e.y)}setupTileCanvas(){this.tileCanvas=ht();const e=this.tileSize;this.tileCanvas.width=e,this.tileCanvas.height=e;const s=this.tileCanvas.getContext("2d");s.fillStyle="#569",s.fillRect(0,0,e,e),s.fillStyle="#303f66",s.beginPath(),s.arc(e/2,e/2,e*.65,0,2*Math.PI),s.fill(),s.lineWidth=2,s.strokeStyle="#569",s.strokeRect(0,0,e,e)}drawBackground(){this.background.startDrawing();const e=this.background.context,s=this.root.windowWidth,i=this.root.windowHeight,n=this.background.worldX,a=this.background.worldY,c=Math.floor((s/2-n)/this.tileSize),l=Math.floor((i/2-a)/this.tileSize),h=Math.floor((-s/2-n)/this.tileSize),d=Math.floor((-i/2-a)/this.tileSize);for(let u=h;u<=c;u++)for(let g=d;g<=l;g++)e.drawImage(this.tileCanvas,u*this.tileSize,g*this.tileSize);this.techTree.drawLines(e),this.background.finalizeDrawing()}}class De{constructor(){o(this,"windowMouse");o(this,"windowWidth");o(this,"windowHeight");o(this,"seed","Shrimp");o(this,"tileSize",63);o(this,"allScreens",[]);o(this,"settings");o(this,"currencyManager");this.allScreens.push(new Be(this)),this.allScreens.push(new Ae(this)),this.allScreens.push(new jt(this,"settings")),this.disableAllScreens(),this.allScreens[0].enable(this,null),this.settings=new Pe(this),this.currencyManager=new Yt(this)}initialize(){this.windowMouse=W.attach(document.body),this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,document.body.dispatchEvent(new Event("resize")),window.addEventListener("resize",()=>{this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,document.body.dispatchEvent(new Event("resize"))}),this.settings.initialize(),this.currencyManager.initialize(),this.allScreens.forEach(t=>t.initialize())}disableAllScreens(){this.allScreens.forEach(t=>t.disable())}update(t){this.allScreens.forEach(e=>e.update(t))}updateFrame(){this.allScreens.forEach(t=>t.updateFrame())}}var Kt=(r=>(r[r.Chrome=0]="Chrome",r[r.Firefox=1]="Firefox",r[r.Safari=2]="Safari",r[r.Edge=3]="Edge",r[r.IE=4]="IE",r[r.Opera=5]="Opera",r[r.Unknown=6]="Unknown",r))(Kt||{});const We=new Wt("Browser Support","✔️");class Zt{static initialize(){this.browser=this.detectBrowser(),We.log("Browser: "+Kt[this.browser]),this.updateScrollbars()}static updateScrollbars(){if(this.browser!==1)return;const t=se("scrollable");for(const e of t)e.classList.remove("scrollable"),e.classList.add("firefox-scrollbar")}static detectBrowser(){const t=navigator.userAgent;return/chrome|crios|crmo/i.test(t)?0:/firefox|fxios/i.test(t)?1:/safari/i.test(t)?2:/edg/i.test(t)?3:/trident/i.test(t)?4:/opr\//i.test(t)?5:6}}o(Zt,"browser");const Dt=new Wt("Error Screen","❌");class Vt{static setInactive(){const t=N("error-screen");t.style.display="none"}static setActive(t=null){let e=t;t instanceof Error&&(e=t.message),t&&(N("error-screen").style.display="flex",xt("#error-screen .error").innerHTML=`<span>Error: </span> ${e}`),N("structure").remove(),Dt.toggleName(),Dt.toggleSymbol(),Dt.error(t)}}class He{constructor(){o(this,"root",new De);o(this,"fpsCounter",new ee)}initialize(){Zt.initialize(),this.root.initialize(),this.preload(),this.startRunning()}preload(){ie(),Vt.setInactive()}startRunning(){const t=this.fpsCounter.update();this.root.update(t),this.root.updateFrame(),requestAnimationFrame(()=>this.startRunning())}}const Ut=new Wt("Index Initialization","✅");Ut.log("Renderer initialized successfully!");Ut.log("Imported main successfully!");Ut.log("Starting the main process...");try{new He().initialize()}catch(r){Vt.setActive(r)}
